<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Tra cứu thông tin văn bằng</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<style>
  .panel {
    display: none;
  }

  .table {
    margin: 0;
  }
</style>

<body>
  <div class="wrapper">

    <!-- topbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="javascript:void(0);">Tra cứu thông tin văn bằng</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://svlao.com">Trang chủ</a></li>
            <li><a href="/">Tra cứu thông tin sinh viên</a></li>
            <li><a href="http://svlao.com/?page_id=28">Liên hệ</a></li>
            <li><a id="link-login" onclick="login()" href="javascript:void(0);">Đăng nhập</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- main content -->
    <div class="content" style="margin-top: 100px;">
      <div class="container">
        <br>
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <form onsubmit="searchStudent(event);">
              <div class="input-group">
                <span class="input-group-addon">Mã sinh viên</span>
                <input id="masv" type="text" class="form-control" name="masv" placeholder="Nhập vào mã sinh viên">
                <span class="input-group-btn">
                  <button class="btn btn-default" type="submit">Tìm</button>
                </span>
              </div>
            </form>
          </div>
        </div>
        <br>
        <br>

        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <div class="panel panel-info">
              <div class="panel-heading">Thông tin văn bằng</div>
              <div class="panel-body" style="padding: 0;">
                <div class="table-responsive">
                  <table class="table">
                    <tbody>
                      <tr>
                        <td>Tên sinh viên</td>
                        <td id="ho-ten">Tên sinh viên</td>
                      </tr>
                      <tr>
                        <td>Ngày sinh</td>
                        <td id="ngay-sinh">Ngày sinh</td>
                      </tr>
                      <tr>
                        <td>Trường</td>
                        <td id="truong">Trường</td>
                      </tr>
                      <tr>
                        <td>Số hiệu</td>
                        <td id="so-hieu">Số hiệu</td>
                      </tr>
                      <tr>
                        <td>Năm tốt nghiệp</td>
                        <td id="nam-tot-nghiep">Năm tốt nghiệp</td>
                      </tr>
                      <tr>
                        <td>Xếp loại</td>
                        <td id="xep-loai">Xếp loại</td>
                      </tr>
                      <tr>
                        <td>Hình thức đào tạo</td>
                        <td id="hinh-thuc-dao-tao">Hình thức đào tạo</td>
                      </tr>
                      <tr>
                        <td>Ngày cấp</td>
                        <td id="ngay-cap">Ngày cấp</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</body>

<script src="js/sweetalert.min.js"></script>
<script src="./js/server-url.js"></script>
<script src="./js/web3.js"></script>

<script>
  async function login() {
    if (typeof (web3) !== 'undefined') {
      web3 = new Web3(web3.currentProvider);
      let result = await ethereum.enable();
      let result2 = await fetch(SERVER_URL + '/student/owner');
      result2.json().then(owner => {
        if (result[0].toLowerCase() == owner.toLowerCase()) {
          window.location = "/list-certificate.html";
        }
        else {
          swal("Thông báo", "Địa chỉ ví đang đăng nhập không có quyền chỉnh sửa dữ liệu. Hãy kiểm tra lại địa chỉ ví đang chọn trong Metamask rồi nhấn lại nút đăng nhập", "error");
        }
      })
    }
    else {
      swal("Máy bạn chưa có Metamask, cài đặt Metamask để đăng nhập vào hệ thống")
        .then((value) => {
          window.open("https://metamask.io/", "_blank");
        });
    }
  }
</script>

<script>
  // function that unhide table when data is return from server:
  function showResult() {
    // show table result:
    var arrPanel = $(".panel");
    for (let i = 0; i < arrPanel.length; i++) {
      arrPanel[i].style.display = "block";
    }
  }

  function searchStudent(event) {
    event.preventDefault();
    fetch(SERVER_URL + "/certificate/certificate?id=" + $("#masv").val())
      .then(response => {
        response.json()
          .then(result => {
            if (!result.thongTinBangTotNghiep.SoHieu) {
              alert("Mã sinh viên không tồn tại trong hệ thống");
              return;
            }
            // also find student mark if he/she existed:
            // searchMark();
            if (response.status == 200) showResult();
            $("#ho-ten").html(result.thongTinCoBan.HoTen || "Chưa cập nhật");
            $("#ngay-sinh").html(result.thongTinCoBan.NgaySinh || "Chưa cập nhật");
            $("#truong").html(result.thongTinCoBan.Truong || "Chưa cập nhật");
            $("#so-hieu").html(result.thongTinBangTotNghiep.SoHieu || "Chưa cập nhật");
            $("#nam-tot-nghiep").html(result.thongTinBangTotNghiep.NamTotNghiep || "Chưa cập nhật");
            $("#xep-loai").html(result.thongTinBangTotNghiep.XepLoai || "Chưa cập nhật");
            $("#hinh-thuc-dao-tao").html(result.thongTinBangTotNghiep.HinhThucDaoTao || "Chưa cập nhật");
            $("#ngay-cap").html(result.thongTinBangTotNghiep.NgayCap || "Chưa cập nhật");
          });
      });
  }

</script>

</html>
